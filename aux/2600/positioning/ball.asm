	processor 6502
	INCLUDE ../vcs.h
	INCLUDE ../macro.h

	SEG.U VARS
	ORG $80

	SEG CODE
	org $F000

BALL_COLOR = $2A
HRULE_COLOR = $78
VRULE_COLOR = $04
BURN_OVERSCAN_LINES = 111

    MAC DRAW

.WAIT SET 0

    REPEAT 50

	STY COLUBK

.CYCLES SET .WAIT

	IF .CYCLES & 1

	BIT VSYNC

.CYCLES SET .CYCLES - 3

	ENDIF

	REPEAT .CYCLES / 2
	NOP
	REPEND

	STA RESBL
	JSR DrawStripes

.WAIT SET .WAIT + 1

    REPEND

    ENDM

DrawStripes SUBROUTINE
	STA WSYNC
	REPEAT 2
	STA COLUBK
	SLEEP 17
	REPEAT 9
	STX COLUBK
	STA COLUBK
	REPEND
	NOP
	REPEND
	RTS

Start
	SEI
	CLD
	LDX #$FF
	TXS
	LDA #0
ClearMem
	STA 0,X
	DEX
	BNE ClearMem

	LDA #0
	STA PF0
	STA PF1
	STA PF2

	LDA #BALL_COLOR
	STA COLUPF
	LDA #2
	STA ENABL

MainLoop

Vsync
	; line 1
	LDA #2
	STA VSYNC
    STA VBLANK
	STA WSYNC

	; line 2
	STA WSYNC

	; line 3
	STA WSYNC

Vblank
	LDA #56
	STA TIM64T
	LDA #0
	STA VSYNC
	LDX #VRULE_COLOR
	LDY #HRULE_COLOR

BurnVblank
	LDA INTIM
	BNE BurnVblank

    LDA #0
    STA VBLANK

	STA WSYNC
	STA WSYNC

Kernal

    DRAW

	LDA 0
	LDA #2
	STA VBLANK
    LDX #BURN_OVERSCAN_LINES

BurnOverscan
	STA WSYNC
	DEX
	BNE BurnOverscan

	JMP  MainLoop

	org $FFFC
	.word Start
	.word Start
